{% extends "base_admin.html" %}
{% block content %}

<div class="dr-card" style="max-width: 980px; margin: auto;">
  <h2 class="dr-page-title" style="margin-bottom: 6px;">Manage Needs</h2>
  <p class="dr-page-subtitle" style="margin-bottom: 18px;">
    NGO: <strong>{{ ngo.name }}</strong> — Add what this NGO currently needs. Fulfilled quantity updates automatically later.
  </p>

  <!-- ADD NEED FORM -->
  <div class="dr-card" style="margin:0 0 16px 0; padding:16px;">
    <h3 style="margin:0 0 10px 0;">Add a New Need</h3>

    <form method="post" class="dr-form">
      <div class="dr-field">
        <label class="dr-label">Item Name *</label>
        <input class="dr-input" name="item_name" placeholder="e.g., Books" required>
      </div>

      <div style="display:grid; grid-template-columns: 1fr 1fr 1fr; gap:12px;">
        <div class="dr-field">
          <label class="dr-label">Category</label>
          <input class="dr-input" name="category" placeholder="e.g., Education">
        </div>

        <div class="dr-field">
          <label class="dr-label">Condition Needed</label>
          <select class="dr-input" name="condition_needed">
            <option value="">Any</option>
            <option value="New">New</option>
            <option value="Used">Used</option>
          </select>
        </div>

        <div class="dr-field">
          <label class="dr-label">Required Quantity *</label>
          <input class="dr-input" type="number" name="qty_required" min="1" placeholder="e.g., 50" required>
        </div>
      </div>

      <div class="dr-field">
        <label class="dr-label">Details</label>
        <textarea class="dr-input" name="details" rows="3"
          placeholder="e.g., Class 8 Math, English & Science books. New preferred but used accepted."></textarea>
      </div>

      <button type="submit" class="dr-btn">Add Need</button>
    </form>
  </div>

  <!-- EXISTING NEEDS -->
  <div class="dr-card" style="margin:0; padding:16px;">
    <h3 style="margin:0 0 12px 0;">Existing Needs</h3>

    {% if needs and needs|length > 0 %}
      <div style="overflow:auto;">
        <table class="dr-table" style="width:100%; border-collapse: collapse;">
          <thead>
            <tr>
              <th>Item</th>
              <th>Category</th>
              <th>Condition</th>
              <th>Required</th>
              <th>Fulfilled</th>
              <th>Remaining</th>
              <th>Status</th>
              <th>Action</th>
            </tr>
          </thead>
          <tbody>
            {% for n in needs %}
              <tr>
                <td>
                  <strong>{{ n.item_name }}</strong>
                  {% if n.details %}
                    <div style="font-size:12px; opacity:0.85; margin-top:4px;">
                      {{ n.details }}
                    </div>
                  {% endif %}
                </td>
                <td>{{ n.category or "—" }}</td>
                <td>{{ n.condition_needed or "Any" }}</td>
                <td>{{ n.qty_required }}</td>
                <td>{{ n.qty_fulfilled }}</td>
                <td>{{ n.qty_remaining }}</td>
                <td>
                  {% if n.is_active %}
                    <span style="font-weight:700;">Active</span>
                  {% else %}
                    <span style="opacity:0.7;">Inactive</span>
                  {% endif %}
                </td>
                <td>
                  <form method="post" action="{{ url_for('admin_toggle_need', need_id=n.id) }}">
                    <button type="submit" class="dr-btn" style="padding:8px 12px;">
                      {% if n.is_active %}Disable{% else %}Enable{% endif %}
                    </button>
                  </form>
                </td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    {% else %}
      <div class="dr-alert dr-alert-warning">No needs added yet for this NGO.</div>
    {% endif %}
  </div>

</div>

{% endblock %}
